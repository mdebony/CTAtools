#!/usr/bin/env python
"""Run a fit for all energies and then in energy bins. Can submit on a cluster"""
import os
import sys
import logging
import numpy as np
from Script.config import getConfig

def sed(config,infile):
  if config['submit'] == 'no':
      if config['analysisPipeline'] == 'gammapy':
          pass
      elif config['analysisChain'] == 'ctools':
          pass
      else :
          logging.error('Unknown analysis chain')
  else :
      logging.error('Submit is actually not yet supported')
    #enricodir = environ.DIRS.get('ENRICO_DIR')
    #fermidir = environ.DIRS.get('FERMI_DIR')

    #GenericName = (config['target']['name'] + "_" +
    #               config['analysis']['likelihood'] +
    #               "_Normal_" + config['file']['tag'])

    #prefix = config['out'] + "/" + GenericName

    #os.system("mkdir -p " + config['out'] + "\n")

    #cmd = enricodir+"/enrico/RunGTlike.py "+os.getcwd()+"/" + infile

    #scriptname = prefix + "_Script.sh"
    #JobLog = prefix + "_Job.log"
    #JobName = GenericName

    #call(cmd, enricodir, fermidir, scriptname, JobLog, JobName)




try:
    infile = sys.argv[1]
except:
    print('Usage: '+sys.argv[0]+' <config file name>')
    mes.error('Config file not found.')

if len(sys.argv)==2 :
#read an config file alone. If not working, try to read an ascii file with different conf file
  try :
    liste = np.genfromtxt(sys.argv[1],dtype="str",unpack=True)
    for inf in liste:
      logging.info("work on the config file "+inf)
      config = getConfig(inf)
      sed(config,inf)
  except :
    config = getConfig(infile)
    sed(config,infile)
else:
  for inf in sys.argv[1:]:
    logging.info("work on the config file "+inf)
    config = getConfig(inf)
    sed(config,inf)
